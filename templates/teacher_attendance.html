{% extends "base.html" %}

{% block title %}Teacher Attendance - Face Recognition Attendance System{% endblock %}

{% block content %}
<div class="row">
	<div class="col-12">
		<div class="card">
			<div class="card-header">
				<h4 class="card-title mb-0">
					<i class="fas fa-clipboard-check me-2"></i>Teacher Attendance Records
				</h4>
			</div>
			<div class="card-body">
				<form method="GET" class="mb-4">
					<div class="row">
						<div class="col-md-4">
							<label for="date" class="form-label">Date</label>
							<input type="date" class="form-control" id="date" name="date" value="{{ selected_date }}">
						</div>
						<div class="col-md-4">
							<label for="department" class="form-label">Department</label>
							<select class="form-control" id="department" name="department">
								<option value="">All Departments</option>
								{% for dep in departments %}
									<option value="{{ dep }}" {% if selected_department == dep %}selected{% endif %}>{{ dep }}</option>
								{% endfor %}
							</select>
						</div>
						<div class="col-md-4 d-flex align-items-end">
							<button type="submit" class="btn btn-primary me-2">
								<i class="fas fa-filter me-1"></i>Filter
							</button>
							<a href="{{ url_for('export_teacher_attendance', date=selected_date) }}" class="btn btn-success">
								<i class="fas fa-download me-1"></i>Export CSV
							</a>
						</div>
					</div>
				</form>

				{% if attendance_records %}
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>Teacher ID</th>
									<th>Name</th>
									<th>Department</th>
									<th>Date</th>
									<th>Time In</th>
									<th>Time Out</th>
									<th>Status</th>
									<th>Duration</th>
								</tr>
							</thead>
							<tbody>
								{% for attendance, teacher in attendance_records %}
									<tr>
										<td><strong>{{ teacher.teacher_id }}</strong></td>
										<td>{{ teacher.name }}</td>
										<td>{{ teacher.department or '-' }}</td>
										<td>{{ attendance.date.strftime('%Y-%m-%d') }}</td>
										<td>
											{% if attendance.time_in %}
												{{ attendance.time_in.strftime('%H:%M:%S') }}
											{% else %}
												<span class="text-muted">-</span>
											{% endif %}
										</td>
										<td>
											{% if attendance.time_out %}
												{{ attendance.time_out.strftime('%H:%M:%S') }}
											{% else %}
												<span class="text-muted">-</span>
											{% endif %}
										</td>
										<td><span class="badge bg-success">{{ attendance.status }}</span></td>
										<td>
											{% if attendance.time_in and attendance.time_out %}
												{% set duration = attendance.time_out - attendance.time_in %}
												{{ duration.seconds // 3600 }}h {{ (duration.seconds % 3600) // 60 }}m
											{% else %}
												<span class="text-muted">-</span>
											{% endif %}
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
					<div class="mt-3">
						<small class="text-muted">Total records: {{ attendance_records|length }} for {{ selected_date }}</small>
					</div>
				{% else %}
					<div class="text-center py-5">
						<i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
						<h5>No Attendance Records Found</h5>
						<p class="text-muted">No teacher attendance records for the selected date and filters.</p>
						<a href="{{ url_for('live_feed') }}?mode=teacher" class="btn btn-primary">
							<i class="fas fa-video me-2"></i>Start Taking Attendance (Teachers)
						</a>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
</div>
{% endblock %}