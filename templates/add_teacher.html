{% extends "base.html" %}

{% block title %}Add Teacher - Smart Attendance System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h2 mb-0">
            <i class="fas fa-user-plus me-2"></i>
            Add New Teacher
        </h1>
        <p class="text-muted">Register a new teacher with photo for face recognition</p>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chalkboard-teacher me-2"></i>
                    Teacher Information
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data" id="addTeacherForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacher_id" class="form-label">
                                <i class="fas fa-id-card me-1"></i>
                                Teacher ID *
                            </label>
                            <input type="text" class="form-control" id="teacher_id" name="teacher_id" 
                                   required pattern="[A-Za-z0-9]+" 
                                   placeholder="e.g., T001, MATH001">
                            <div class="form-text">Unique identifier for the teacher</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">
                                <i class="fas fa-user me-1"></i>
                                Full Name *
                            </label>
                            <input type="text" class="form-control" id="name" name="name" 
                                   required placeholder="e.g., John Doe">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope me-1"></i>
                                Email Address *
                            </label>
                            <input type="email" class="form-control" id="email" name="email" 
                                   required placeholder="e.g., john.doe@school.edu">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="phone" class="form-label">
                                <i class="fas fa-phone me-1"></i>
                                Phone Number
                            </label>
                            <input type="tel" class="form-control" id="phone" name="phone" 
                                   placeholder="e.g., +1-555-123-4567">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="department" class="form-label">
                                <i class="fas fa-building me-1"></i>
                                Department
                            </label>
                            <select class="form-select" id="department" name="department">
                                <option value="">Select Department</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="Science">Science</option>
                                <option value="English">English</option>
                                <option value="History">History</option>
                                <option value="Geography">Geography</option>
                                <option value="Physical Education">Physical Education</option>
                                <option value="Arts">Arts</option>
                                <option value="Music">Music</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Languages">Languages</option>
                                <option value="Administration">Administration</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="image" class="form-label">
                                <i class="fas fa-camera me-1"></i>
                                Photo *
                            </label>
                            <input type="file" class="form-control" id="image" name="image" 
                                   required accept="image/*" onchange="previewImage(this)">
                            <div class="form-text">Upload a clear, front-facing photo for face recognition</div>
                        </div>
                    </div>
                    
                    <!-- Image Preview -->
                    <div class="row mb-3" id="imagePreviewContainer" style="display: none;">
                        <div class="col-12">
                            <label class="form-label">Photo Preview</label>
                            <div class="text-center">
                                <img id="imagePreview" src="" alt="Preview" 
                                     class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Photo Guidelines -->
                    <div class="alert alert-info">
                        <h6><i class="fas fa-lightbulb me-2"></i>Photo Guidelines</h6>
                        <ul class="mb-0">
                            <li>Use a clear, high-quality photo</li>
                            <li>Ensure good lighting and clear visibility of the face</li>
                            <li>Face should be centered and looking directly at the camera</li>
                            <li>Avoid sunglasses, hats, or other accessories that cover the face</li>
                            <li>Recommended size: at least 300x300 pixels</li>
                        </ul>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('teachers') }}" class="btn btn-secondary me-md-2">
                            <i class="fas fa-arrow-left me-2"></i>
                            Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            Add Teacher
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-check-circle me-2"></i>
                    Teacher Added Successfully!
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>The teacher has been successfully added to the system and their face data has been processed for recognition.</p>
                <p><strong>Next steps:</strong></p>
                <ul>
                    <li>The teacher can now use the face recognition system</li>
                    <li>Their attendance will be tracked automatically</li>
                    <li>You can view their attendance records in the Teacher Attendance section</li>
                </ul>
            </div>
            <div class="modal-footer">
                <a href="{{ url_for('add_teacher') }}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>
                    Add Another Teacher
                </a>
                <a href="{{ url_for('teachers') }}" class="btn btn-success">
                    <i class="fas fa-users me-2"></i>
                    View All Teachers
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function previewImage(input) {
    const preview = document.getElementById('imagePreview');
    const container = document.getElementById('imagePreviewContainer');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            preview.src = e.target.result;
            container.style.display = 'block';
        };
        
        reader.readAsDataURL(input.files[0]);
    } else {
        container.style.display = 'none';
    }
}

// Form validation
document.getElementById('addTeacherForm').addEventListener('submit', function(e) {
    const teacherId = document.getElementById('teacher_id').value;
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const image = document.getElementById('image').files[0];
    
    // Basic validation
    if (!teacherId.match(/^[A-Za-z0-9]+$/)) {
        e.preventDefault();
        alert('Teacher ID should only contain letters and numbers');
        return;
    }
    
    if (name.length < 2) {
        e.preventDefault();
        alert('Name should be at least 2 characters long');
        return;
    }
    
    if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
        e.preventDefault();
        alert('Please enter a valid email address');
        return;
    }
    
    if (!image) {
        e.preventDefault();
        alert('Please select a photo');
        return;
    }
    
    // Check file size (max 5MB)
    if (image.size > 5 * 1024 * 1024) {
        e.preventDefault();
        alert('Photo size should be less than 5MB');
        return;
    }
    
    // Check file type
    if (!image.type.startsWith('image/')) {
        e.preventDefault();
        alert('Please select a valid image file');
        return;
    }
});

// Show success modal if redirected from successful submission
if (window.location.search.includes('success=true')) {
    const modal = new bootstrap.Modal(document.getElementById('successModal'));
    modal.show();
}
</script>
{% endblock %}